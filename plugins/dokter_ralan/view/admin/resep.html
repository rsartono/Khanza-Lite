<ul class="nav nav-tabs" role="tablist">
    <li role="presentation" class="active"><a href="#resep_umum" aria-controls="resep_umum" role="tab" data-toggle="tab">Umum</a></li>
    <li role="presentation"><a href="#resep_racikan" aria-controls="resep_racikan" role="tab" data-toggle="tab">Racikan</a></li>
</ul>

<div class="panel-default">
    <div class="panel-body">
        <div class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="resep_umum">
                <form name="dokter_ralan" action="{?=url(ADMIN.'/dokter_ralan/resepsave/'.@$dokter_ralan.no_rawat)?}" method="POST">
                <div class="row clearfix" id="item_resep">
                    <div class="col-md-5">
                        <div class="form-group">
                            <label>Nama Obat</label>
                            <select name="kode_brng[]" class="form-control databarang_ajax">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="form-group">
                            <label>Jumlah</label>
                            <input type="text" name="jml[]" class="form-control" />
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="form-group">
                            <label>Aturan Pakai</label>
                            <select name="aturan_pakai[]" class="form-control master_aturan_pakai">
                            </select>
                        </div>
                    </div>
                    <div class="col-md-1">
                    </div>
                </div>
                <span class="btn btn-default btn-success add">Tambah</span>
                <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
                <a href="" class="btn btn-default">Batal</a>
                </form>
            </div>
            <div role="tabpanel" class="tab-pane fade in" id="resep_racikan">
              <form method="post" action="{?=url(ADMIN.'/dokter_ralan/resepracikansave/'.@$dokter_ralan.no_rawat)?}">
              <div class="row clearfix" id="item_racikan">
                  <div class="clearfix" style="border-bottom: #ddd 1px solid;margin-bottom:20px;">
                  <div class="col-md-4">
                      <div class="form-group">
                          <label>Nama Racikan</label>
                          <input type="text" name="nama_racik[]" class="form-control" />
                      </div>
                  </div>
                  <div class="col-md-4">
                      <div class="form-group">
                          <label>Metode Racik</label>
                          <input type="text" name="kd_racik[]" class="form-control" />
                      </div>
                  </div>
                  <div class="col-md-2">
                      <div class="form-group">
                          <label>Kandungan</label>
                          <input type="text" name="kandungan_1[]" class="form-control" />
                      </div>
                  </div>
                  <div class="col-md-2">
                      <div class="form-group">
                          <label>Jumlah</label>
                          <input type="text" name="jml_dr[]" class="form-control" />
                      </div>
                  </div>
                  <div class="col-md-5">
                      <div class="form-group">
                          <label>Aturan Pakai</label>
                          <select name="aturan_pakai[]" class="form-control master_aturan_pakai">
                          </select>
                      </div>
                  </div>
                  <div class="col-md-6">
                      <div class="form-group">
                          <label>Nama Obat</label>
                          <select name="kode_brng_1[]" class="form-control databarang_ajax" multiple>
                          </select>
                      </div>
                  </div>
                  <div class="col-md-1">
                  </div>
              </div>
              </div>
              <span class="btn btn-default btn-success add_racikan">Tambah</span>
              <input type="submit" name="save" value="Simpan" class="btn btn-primary" />
              <a href="" class="btn btn-default">Batal</a>
              </form>
            </div>
        </div>
    </div>
</div>

<script>
  $(document).ready(function() {
      $(document).on('click', '.add', function(){
          var html = '';
          html += '<div class="clearfix row_resep">';
          html += '   <div class="col-md-5">';
          html += '       <div class="form-group">';
          html += '            <label class="visible-xs">Nama Obat</label>';
          html += '            <select name="kode_brng[]" class="form-control databarang_ajax">';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-2">';
          html += '        <div class="form-group">';
          html += '            <label class="visible-xs">Jumlah</label>';
          html += '            <input type="text" name="jml[]" class="form-control" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-4">';
          html += '        <div class="form-group">';
          html += '            <label class="visible-xs">Aturan Pakai</label>';
          html += '            <select name="aturan_pakai[]" class="form-control master_aturan_pakai">';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-1">';
          html += '      <div class="form-group">';
          html += '            <label>&nbsp;</label>';
          html += '            <button class="btn btn-danger remove">-</button>';
          html += '        </div>';
          html += '    </div>';
          html += '</div>';
          $('#item_resep').append(html);
          var strip_tags = function(str) {
            return (str + '').replace(/<\/?[^>]+(>|$)/g, '')
          };
          var truncate_string = function(str, chars) {
            if ($.trim(str).length <= chars) {
              return str;
            } else {
              return $.trim(str.substr(0, chars)) + '…';
            }
          };
          $('.databarang_ajax').selectator({
            labels: {
              search: 'Cari obat...'
            },
            load: function (search, callback) {
              if (search.length < this.minSearchLength) return callback();
              $.ajax({
                url: '{?=url()?}/admin/dokter_ralan/ajax?show=databarang&nama_brng=' + encodeURIComponent(search) + '&t={?=$_SESSION['token']?}',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data.slice(0, 100));
                  console.log(data);
                },
                error: function() {
                  callback();
                }
              });
            },
            delay: 300,
            minSearchLength: 1,
            valueField: 'kode_brng',
            textField: 'nama_brng'
          });
          $('.master_aturan_pakai').selectator({
            labels: {
              search: 'Cari aturan pakai...'
            },
            load: function (search, callback) {
              if (search.length < this.minSearchLength) return callback();
              $.ajax({
                url: '{?=url()?}/admin/dokter_ralan/ajax?show=aturan_pakai&aturan=' + encodeURIComponent(search) + '&t={?=$_SESSION['token']?}',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data.slice(0, 100));
                  console.log(data);
                },
                error: function() {
                  callback();
                }
              });
            },
            delay: 300,
            minSearchLength: 1,
            valueField: 'aturan',
            textField: 'aturan'
          });
          $('select').each(function () {
              var options = {
                  useDimmer: true,
                  useSearch: true,
                  labels: {
                      search: '...'
                  }
              };
              $.each($(this).data(), function (key, value) {
                  options[key] = value;
              });
              $(this).selectator(options);
          });
      });

      $(document).on('click', '.remove', function(){
          $(this).closest('.row_resep').remove();
      });

      var count=2;
      $(document).on('click', '.add_racikan', function(){
          var html = '';
          html += '<div class="clearfix row_racikan" style="border-bottom: #ddd 1px solid;margin-top: 20px;margin-bottom:20px;">';
          html += '   <div class="col-md-4">';
          html += '       <div class="form-group">';
          html += '            <label>Nama Racikan</label>';
          html += '            <input type="text" name="nama_racik[]" class="form-control" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-4">';
          html += '        <div class="form-group">';
          html += '            <label>Metode Racikan</label>';
          html += '            <input type="text" name="kd_racik[]" class="form-control" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-2">';
          html += '        <div class="form-group">';
          html += '            <label>Kandungan</label>';
          html += '            <select name="kandungan_'+count+'[]" class="form-control"';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-2">';
          html += '        <div class="form-group">';
          html += '            <label>Jumlah</label>';
          html += '            <input type="text" name="jml_dr[]" class="form-control" />';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-5">';
          html += '        <div class="form-group">';
          html += '            <label>Aturan Pakai</label>';
          html += '            <select name="aturan_pakai[]" class="form-control master_aturan_pakai">';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-6">';
          html += '        <div class="form-group">';
          html += '            <label>Nama Obat</label>';
          html += '            <select name="kode_brng_'+count+'[]" class="form-control databarang_ajax" multiple>';
          html += '            </select>';
          html += '        </div>';
          html += '    </div>';
          html += '    <div class="col-md-1">';
          html += '      <div class="form-group">';
          html += '            <label>Aksi</label>';
          html += '            <button class="btn btn-danger remove_racikan">-</button>';
          html += '        </div>';
          html += '    </div>';
          html += '</div>';
          $('#item_racikan').append(html);
          count++;
          console.log(html);
          var strip_tags = function(str) {
            return (str + '').replace(/<\/?[^>]+(>|$)/g, '')
          };
          var truncate_string = function(str, chars) {
            if ($.trim(str).length <= chars) {
              return str;
            } else {
              return $.trim(str.substr(0, chars)) + '…';
            }
          };
          $('.databarang_ajax').selectator({
            labels: {
              search: 'Cari obat...'
            },
            load: function (search, callback) {
              if (search.length < this.minSearchLength) return callback();
              $.ajax({
                url: '{?=url()?}/admin/dokter_ralan/ajax?show=databarang&nama_brng=' + encodeURIComponent(search) + '&t={?=$_SESSION['token']?}',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data.slice(0, 100));
                  console.log(data);
                },
                error: function() {
                  callback();
                }
              });
            },
            delay: 300,
            minSearchLength: 1,
            valueField: 'kode_brng',
            textField: 'nama_brng'
          });
          $('.master_aturan_pakai').selectator({
            labels: {
              search: 'Cari aturan pakai...'
            },
            load: function (search, callback) {
              if (search.length < this.minSearchLength) return callback();
              $.ajax({
                url: '{?=url()?}/admin/dokter_ralan/ajax?show=aturan_pakai&aturan=' + encodeURIComponent(search) + '&t={?=$_SESSION['token']?}',
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                  callback(data.slice(0, 100));
                  console.log(data);
                },
                error: function() {
                  callback();
                }
              });
            },
            delay: 300,
            minSearchLength: 1,
            valueField: 'aturan',
            textField: 'aturan'
          });
          $('select').each(function () {
              var options = {
                  useDimmer: true,
                  useSearch: true,
                  labels: {
                      search: '...'
                  }
              };
              $.each($(this).data(), function (key, value) {
                  options[key] = value;
              });
              $(this).selectator(options);
          });

      });

      $(document).on('click', '.remove_racikan', function(){
          $(this).closest('.row_racikan').remove();
      });

  });
</script>
